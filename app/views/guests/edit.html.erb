<h2>Edit Person</h2>

<%= form_with model: @person, url: guest_path(@person), method: :patch, local: true do |f| %>
  <div class="mb-3">
    <%= f.label :name %>
    <%= f.text_field :name, class: "form-control", required: true %>
  </div>

  <div class="mb-3">
    <%= f.label :email %>
    <%= f.email_field :email, class: "form-control" %>
  </div>

  <div class="mb-3">
    <%= f.label :phone %>
    <%= f.telephone_field :phone, class: "form-control" %>
  </div>

  <div class="form-check mb-2">
    <%= f.check_box :volunteer, class: "form-check-input", id: "person_volunteer" %>
    <%= f.label :volunteer, "Volunteer", class: "form-check-label", for: "person_volunteer" %>
  </div>

  <%= f.submit "Save Changes", class: "btn btn-primary" %>
  <%= link_to "Cancel", guests_path, class: "btn btn-secondary ms-2" %>
<% end %>

<hr class="my-4">
<%= form_with url: merge_guest_path(@person), method: :post do %>
  <div class="mb-3">
    <label for="merge_with_id">Merge this person into: (this will delete the current person and move all records to the selected person)</label>
    <%= select_tag :merge_with_id,
      options_from_collection_for_select(Person.where.not(id: @person.id), :id, :name),
      prompt: "Select person to merge into",
      class: "form-select" %>
  </div>
  <%= submit_tag "Merge People", class: "btn btn-danger", data: { turbo_confirm: "Are you sure? This will move all sign-ins and notes from this person into the selected person and delete this record." } %>
<% end %>
<div class="card border-warning">
  <div class="card-header bg-warning">
    Archive
  </div>
  <div class="card-body">
    <% if @person.archived? %>
      <p class="mb-2">This person is archived and will not appear in guest lists. They will still appear in search results.</p>
      <%= button_to "Unarchive Person",
                    unarchive_guest_path(@person),
                    method: :patch,
                    class: "btn btn-success",
                    data: { turbo_confirm: "Unarchive #{@person.name}?" } %>
    <% else %>
      <p class="mb-2">Archiving hides this person from guest lists but keeps their data and sign-ins.</p>
      <%= button_to "Archive Person",
                    archive_guest_path(@person),
                    method: :patch,
                    class: "btn btn-outline-warning",
                    data: { turbo_confirm: "Archive #{@person.name}? They will be hidden from guest lists but still appear in search." } %>
    <% end %>
  </div>
</div>

<hr class="my-4">

<div class="card border-danger">
  <div class="card-header bg-danger text-white">
    Danger Zone
  </div>
  <div class="card-body">
    <p class="mb-2">
      Warning: Deleting this person will permanently remove all their sign-in records
      (<strong><%= @person.sign_ins.count %></strong> total). This action cannot be undone.
    </p>
    <%= button_to "Delete Person",
                  guest_path(@person),
                  method: :delete,
                  form: { class: "d-inline" },
                  data: {
                    turbo_confirm: "Are you sure? This will permanently delete #{@person.name} and ALL their sign-in records. This cannot be undone.",
                    turbo: false
                  },
                  class: "btn btn-danger" %>
  </div>
</div>
